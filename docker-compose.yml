# @format

# version: "3.8"

services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    image: tcon360_backend
    container_name: tcbackend
    ports:
      - "3800:3800" # host:container – primary backend port
      - "3300:3800" # host:container – extra local VM access
    environment:
      - NODE_ENV=development
      - JWT_SECRET=aBcDeFgHiJkLmNoPqRsTuVwXyZ0123456789ABCDEF
      - DATABASE_URL=file:/config/workspace/vm/js/TCon360/TCon360.db
      - BACKEND_PORT=3800
      - TOKEN_MAX_AGE=12000000
    volumes:
      - ./:/config/workspace/vm/js/TCon360
      - ./TCon360.db:/config/workspace/vm/js/TCon360/TCon360.db
    command: ["pnpm", "--filter", "backend", "run", "start:dev"]
    networks:
      - app-network

  frontend:
    image: tcon360_frontend
    container_name: tcfrontend
    ports:
      - "8255:8255" # host → container (UI)
    environment:
      - NODE_ENV=development
      - PORT=8255 # ← Next.js binds to this inside the container
      - JWT_SECRET=aBcDeFgHiJkLmNoPqRsTuVwXyZ0123456789
      - NEXTAUTH_SECRET=aBcDeFgHiJkLmNoPqRsTuVwXyZ0123456789ABCDEF # ← ADD THIS
      - BACKEND_PORT=3800
      - TOKEN_MAX_AGE=12000000
      - FRONTEND_PORT=8255
      - USE_REVERSE_PROXY=false
      - PROXY_PATH=
      - NEXT_PUBLIC_BASEPATH=
    depends_on:
      - backend
    networks:
      - app-network

networks:
  app-network:
    driver: bridge
